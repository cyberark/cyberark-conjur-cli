FROM registry.access.redhat.com/ubi8/ubi:8.3

ENV INSTALL_DIR=/opt/conjur-api-python3
RUN cat /etc/os-release

RUN yum update \
        && yum install -y bash \
                binutils \
                yum-utils \
                gcc gcc-c++ make \
                curl \
                git \
                jq \
                libffi-devel \
                openssl \
                python3 \
                python3-devel \
                python3-pip \
                wget

RUN wget http://mirror.centos.org/centos/8/AppStream/aarch64/os/Packages/gnome-keyring-3.28.2-1.el8.aarch64.rpm
RUN wget http://mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/dbus-daemon-1.12.8-12.el8_3.x86_64.rpm
RUN mkdir -p $INSTALL_DIR
WORKDIR $INSTALL_DIR

COPY ./requirements.txt $INSTALL_DIR/
RUN pip3 install -r requirements.txt

COPY . $INSTALL_DIR

COPY ./test/configure_dbus.sh /configure_dbus.sh

ENTRYPOINT ["./test/configure_dbus.sh"]

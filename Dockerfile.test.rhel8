FROM registry.access.redhat.com/ubi8/ubi:8.3

ENV INSTALL_DIR=/opt/conjur-api-python3
RUN cat /etc/os-release

RUN yum update
RUN yum search gnome-keyring
RUN  yum install -y bash \
                binutils \
                gcc gcc-c++ make \
                curl \
                git \
                jq \
                libffi-devel \
                openssl \
                python3 \
                python3-devel \
                python3-pip \
                gnome-keyring \
                dbus-x11

RUN mkdir -p $INSTALL_DIR
WORKDIR $INSTALL_DIR

COPY ./requirements.txt $INSTALL_DIR/
RUN pip3 install -r requirements.txt

COPY . $INSTALL_DIR

COPY ./test/configure_dbus.sh /configure_dbus.sh

ENTRYPOINT ["./test/configure_dbus.sh"]

#!/bin/bash -e

SRC_DIRS=( "./conjur"
           "./pkg_bin" )

DISABLED_ERRORS="fixme"

cleanup() {
  echo "Cleaning up..."
  docker-compose logs test
  docker-compose rm --stop --force
}
trap 'cleanup' EXIT

echo "Building API container..."
docker-compose build

docker-compose up -d --no-deps test

for src_dir in "${SRC_DIRS[@]}"; do
  echo "Checking linting in $src_dir..."
  set -x
  docker-compose exec \
    test \
    pylint -r n -f parseable --disable="$DISABLED_ERRORS" "$src_dir"
done

echo "Linting completed!"
